GO_VERSION := $(shell go version | cut -c 14- | cut -d' ' -f1 | cut -d'.' -f1,2)

###############################################################################
###                                  Build                                  ###
###############################################################################

build: ensure_version
	go build -mod=readonly -o ./build/ksync ./cmd/ksync/main.go

###############################################################################
###                                  Tests                                  ###
###############################################################################

test:
	docker build --platform linux/amd64 --no-cache -t ksync:test .

###############################################################################
###                                 Checks                                  ###
###############################################################################

ensure_version:
ifneq ($(GO_VERSION),1.22)
	$(error ‚ùå  Please run Go v1.22.x..)
endif
